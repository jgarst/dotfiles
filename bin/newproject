#!/usr/bin/env python
"""Script to copy new project template."""

import os
import shutil
from pathlib import Path
import argparse
import subprocess


PROJECT_TEMPLATE = Path(os.path.expandvars("$XDG_CONFIG_HOME"), "NewProject")


def main() -> None:
    """Take name of new project from arguments, and create that directory."""
    parser = argparse.ArgumentParser(
        description="Create a new project in the given directory."
    )
    parser.add_argument('directory', help="directory to create.")
    args = parser.parse_args()

    path = Path(args.directory).absolute()
    shutil.copytree(PROJECT_TEMPLATE, path)

    try:
        os.chdir(path)
        subprocess.check_output(('git', 'init'))
        subprocess.check_output(('git', 'add', '-A'))
        subprocess.check_output(('git', 'commit', '-m', 'initial commit'))
    except subprocess.CalledProcessError:
        shutil.rmtree(path)
        exit(1)

    exit(0)


if __name__ == "__main__":
    main()
