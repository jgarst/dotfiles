#! /usr/bin/env bash
set -uf

pikaur -Syu

printf "\n"
printf "\033[1mchecking for orphaned packages\033[0m\n"
mapfile -t orphans < <(pikaur -Qtdq)

if [ ${#orphans[@]} -ne 0 ]
then
    pikaur -Rns "${orphans[@]}"
fi

printf "\n"
printf "\033[1mupdating passwords\033[0m\n"
if [ -d "${PASSWORD_STORE_DIR:-~/.password-store}/.git" ]
then
    git -C "${PASSWORD_STORE_DIR:-~/.password-store}" pull
    git -C "${PASSWORD_STORE_DIR:-~/.password-store}" push
fi


if [ -x "$(command -v fwupdmgr)" ]
then
    fwupdmgr refresh && fwupdmgr get-updates
fi

if [ -x "$(command -v bat)" ]
then
    (cd / && bat cache --build)
fi

home submodule update --init --remote --rebase
